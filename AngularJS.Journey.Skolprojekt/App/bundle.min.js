(function(){angular.module("AngularJourneyApp",["ngRoute","LocalStorageModule","chart.js"]);angular.module("AngularJourneyApp").run(["loginService",function(n){n.fillAuthData()}]);angular.module("AngularJourneyApp").config(["$httpProvider",function(n){n.interceptors.push("authInterceptorService")}])})(),function(){angular.module("AngularJourneyApp").config(["$routeProvider","$locationProvider",function(n,t){t.hashPrefix("");n.when("/login",{controller:"loginController",templateUrl:"/App/Views/login.html"});n.when("/home",{controller:"homeController",templateUrl:"/App/Views/home.html"});n.when("/register",{controller:"registerController",templateUrl:"/App/Views/register.html"});n.when("/mainpage",{controller:"mainpageController",templateUrl:"/App/Views/mainpage.html"});n.when("/vehicle",{controller:"vehicleController",templateUrl:"/App/Views/vehicle.html"});n.when("/trip",{controller:"tripController",templateUrl:"/App/Views/trip.html"});n.when("/report",{controller:"reportController",templateUrl:"/App/Views/report.html"});n.when("/support",{templateUrl:"App/views/support.html",controller:"supportController",controllerAs:"vm"});n.otherwise({redirectTo:"/home"})}])}(),function(){"use strict";angular.module("AngularJourneyApp").factory("vehicleService",["$http",function(n){var t={},i=function(t){return n.post("https://localhost:44341/api/Vehicles",t).then(function(n){return n})},r=function(){return n.get("https://localhost:44341/api/Vehicles").then(function(n){return n})};return t.saveVehicle=i,t.getSavedVehicles=r,t}])}(),function(){"use strict";angular.module("AngularJourneyApp").factory("tripService",["$http",function(n){var t={},i=function(t){return n.post("https://localhost:44341/api/Trips",t).then(function(n){return n})},r=function(){return n.get("https://localhost:44341/api/Trips").then(function(n){return n})};return t.addTrip=i,t.getAllTrips=r,t}])}(),function(){"use strict";angular.module("AngularJourneyApp").factory("reportService",["$http",function(n){var t={},i=function(t){return n.post("https://localhost:44341/api/report",t).then(function(n){return n})},r=function(t){return n.post("https://localhost:44341/api/report/chart",t).then(function(n){return n})};return t.createChart=r,t.getPdf=i,t}])}(),function(){"use strict";angular.module("AngularJourneyApp").factory("registerService",["$http",function(n){var t={},i=function(t){return n.post("https://localhost:44341/api/account/register",t).then(function(n){return n})};return t.saveRegistration=i,t}])}(),function(){"use strict";angular.module("AngularJourneyApp").factory("loginService",["$http","$q","localStorageService",function(n,t,i){var u={},r={isAuth:!1,userName:"",token:""},e=function(u){var o="grant_type=password&username="+u.userName+"&password="+u.password,e=t.defer();return n.post("https://localhost:44341/token",o,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(n){i.set("authorizationData",{token:n.data.access_token});r.isAuth=!0;r.userName=u.userName;r.token=n.data.access_token;e.resolve(n)}),function(n){f();e.reject(n)},e.promise},o=function(){var n=i.get("authorizationData");n&&(r.isAuth=!0,r.userName=n.userName)},f=function(){i.remove("authorizationData");r.isAuth=!1;r.userName=""};return u.logOut=f,u.login=e,u.fillAuthData=o,u.authentication=r,u}])}(),function(){"use strict";angular.module("AngularJourneyApp").factory("geoLocationService",["$http","$q",function(){return{getUserLocation:function(n){function t(n){console.log(n)}function i(t){var r=new google.maps.Geocoder,i=t.coords,u={lat:parseFloat(i.latitude),lng:parseFloat(i.longitude)};r.geocode({location:u},function(t,i){if(i==google.maps.GeocoderStatus.OK,t[0]){var r=t[0].formatted_address;console.log(r);n(r)}})}navigator.geolocation?navigator.geolocation.getCurrentPosition(i,t):Console.log("Inget stöd för geolocation.")}}}])}();angular.module("AngularJourneyApp").factory("authInterceptorService",["$q","$location","localStorageService",function(n,t,i){var r={},u=function(n){n.headers=n.headers||{};var t=i.get("authorizationData");return t&&(n.headers.Authorization="Bearer "+t.token),n},f=function(i){return i.status===401&&t.path("/home"),n.reject(i)};return r.request=u,r.responseError=f,r}]),function(){angular.module("AngularJourneyApp").controller("vehicleController",["$scope","$window","vehicleService","$http","localStorageService",function(n,t,i,r){n.vehicles=[];defaultVehicle=localStorage.getItem("DefaultVehicle");n.newVehicle={LicensNumber:"",Status:!0};n.getAllVehicles=function(){i.getSavedVehicles().then(function(t){n.vehicles=t.data},function(n){n})};n.registerVehicle=function(){i.saveVehicle(n.newVehicle).then(function(){n.newVehicle.LicensNumber=null;n.getAllVehicles()},function(n){n})};n.defaultVehicle=function(i){var r=n.vehicles[i];t.localStorage.removeItem("DefaultVehicle");t.localStorage.setItem("DefaultVehicle",r.carId)};n.deleteVehicle=function(t){confirm("Vill du ta bort bilen?")&&r({method:"DELETE",url:"https://localhost:44341/api/Vehicles/"+n.vehicles[t].carId}).then(function(){n.vehicles.splice(t,1)},function(n){alert("Error : "+n.data.ExceptionMessage)})};n.updateVehicle=function(t){r({method:"PUT",url:"https://localhost:44341/api/Vehicles/"+n.vehicles[t].carId}).then(function(){n.vehicles.splice(t,1);n.getAllVehicles()},function(n){alert("Error : "+n.data.ExceptionMessage)})}}])}(),function(){angular.module("AngularJourneyApp").controller("tripController",["$scope","$window","geoLocationService","tripService","vehicleService","localStorageService",function(n,t,i,r,u){n.vehicles=[];n.message="";n.trip={Vehicle:"",Date:"",MileageStart:"",MileageStop:"",DistanceTraveled:"",AdressStart:"",AdressStop:"",Erand:"",Notes:""};n.saveTrip=function(){r.addTrip(n.trip).then(function(){n.message="Resan sparades!";n.trip=undefined;n.trip.Notes=""},function(n){n})};n.getAllVehicles=function(){var i=t.localStorage.getItem("DefaultVehicle");n.defaultVehicle=i;u.getSavedVehicles().then(function(t){var i=[];t.data.forEach(function(t){n.defaultVehicle&&t.carId==n.defaultVehicle?(n.trip.Vehicle=t.carId,i.unshift(t)):i.push(t)});n.vehicles=i},function(n){n})};n.getStartLocation=function(){i.getUserLocation(function(t){n.trip.AdressStart=t;n.$digest()})};n.getStopLocation=function(){i.getUserLocation(function(t){n.trip.AdressStop=t;n.$digest()})}}])}(),function(){angular.module("AngularJourneyApp").controller("supportController",["$scope","loginService","$http","$location","$q",function(n,t){var i=this,r;i.token=t.authentication.token;i.userName=t.authentication.userName;r=$.connection.supportHub;$.connection.hub.logging=!0;$.connection.qs={token:i.token};$.connection.hub.qs={userName:i.userName,token:i.token};r.client.broadcastMessage=function(n,t){var u=$("<div />").text(n).html(),f=$("<div />").text(t).html(),r="alert alert-warning";n===i.userName&&(console.log(n),console.log(i.userName),r="alert alert-info text-right");$("#discussion").prepend('<div class="'+r+'"><strong>'+u+"<\/strong><br />"+f+"<\/div>")};$("#message").focus();$.connection.hub.start().done(function(){$("#sendmessage").click(function(){r.server.send($("#displayname").val(),$("#message").val());$("#message").val("").focus()})});i.authentication=t.authentication}])}(),function(){angular.module("AngularJourneyApp").controller("reportController",["$scope","vehicleService","reportService",function(n,t,i){n.data=[];n.labels=["Korta resor","Mellan resor","Långa resor"];n.vehicles=[];n.VehicleDate={Vehicle:"",Date1:"",Date2:""};n.getReport=function(){i.getPdf(n.VehicleDate).then(function(){},function(n){n})};n.createChart=function(){i.createChart(n.VehicleDate).then(function(t){var r,i;n.data=[];n.labels=[];r=t.data;console.log(r);i={short:0,medium:0,long:0};angular.forEach(r,function(n){n.distanceTraveled<=20&&i.short++;n.distanceTraveled>=21&&n.distanceTraveled<=50&&i.medium++;n.distanceTraveled>=51&&i.long++});n.data=[i.short,i.medium,i.long];n.labels=["0-20km","21-50km","50km+"];console.log(i)},function(n){n})};n.getAllVehicles=function(){t.getSavedVehicles().then(function(t){n.vehicles=t.data},function(n){n})}}])}(),function(){"use strict";angular.module("AngularJourneyApp").controller("registerController",["$scope","$location","$timeout","registerService",function(n,t,i,r){n.savedSuccessfully=!1;n.message="";n.registration={userName:"",password:"",confirmPassword:""};n.register=function(){r.saveRegistration(n.registration).then(function(){n.savedSuccessfully=!0;n.message="användare "+n.registration.userName+" har blivit registrerad, omredigeras till login sidan om 3 sekunder.";u()},function(t){var u=[],r,i;for(r in t.data.modelState)for(i=0;i<t.data.modelState[r].length;i++)u.push(t.data.modelState[r][i]);n.message="Misslyckades att registrera ny användare på grund av:"+u.join(" ")})};var u=function(){var n=i(function(){i.cancel(n);t.path("/home")},3e3)}}])}(),function(){angular.module("AngularJourneyApp").controller("mainpageController",["$scope","tripService",function(){}])}(),function(){angular.module("AngularJourneyApp").controller("indexController",["$scope","$location","loginService",function(n,t,i){n.logOut=function(){i.logOut();t.path("/home")};n.authentication=i.authentication}])}(),function(){"use strict";angular.module("AngularJourneyApp").controller("homeController",["$scope","$location","loginService",function(n,t,i){n.loginData={userName:"",password:""};n.message="";n.login=function(){i.login(n.loginData).then(function(){t.path("/mainpage")},function(t){n.message=t.error_description})}}])}();